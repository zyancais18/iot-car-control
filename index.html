<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Control IoT</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
  <header class="app-header px-3 py-2">
    <div class="container-fluid d-flex align-items-center justify-content-between">
      <h1 class="h4 m-0 text-white">Control IoT</h1>
      <div class="d-flex gap-4 align-items-center text-white">
        <div class="form-check form-switch m-0">
          <input class="form-check-input" type="radio" name="mode" id="modeManual" checked>
          <label class="form-check-label" for="modeManual">Manual</label>
        </div>
        <div class="form-check form-switch m-0">
          <input class="form-check-input" type="radio" name="mode" id="modeAuto">
          <label class="form-check-label" for="modeAuto">Automático</label>
        </div>
      </div>
    </div>
  </header>

  <main class="container py-4">
    <!-- Barra de controles (solo Automático) -->
    <div id="autoBar" class="row g-2 align-items-center mb-3 d-none">
      <div class="col-auto"><span class="label">ms</span></div>
      <div class="col-auto"><input id="msInput" type="number" class="form-control form-control-sm slim" value="200" min="50" step="50"></div>
      <div class="col-auto"><button id="btnGrabar" class="btn btn-outline-primary btn-sm">Grabar</button></div>
      <div class="col-auto"><button id="btnGuardar" class="btn btn-outline-primary btn-sm" disabled>Guardar</button></div>
      <div class="col-auto"><button id="btnCargar" class="btn btn-outline-primary btn-sm">Cargar</button></div>
      <div class="col-auto"><button id="btnDetener" class="btn btn-outline-danger btn-sm" disabled>Detener</button></div>
    </div>

    <!-- La flor de botones -->
    <section class="d-flex justify-content-center position-relative">
      <div id="flower" class="flower position-relative">
        <!-- Indicador de grabación (al lado de la figura) -->
        <div id="recStatus"
             class="small text-secondary"
             style="position:absolute; right:-150px; top:0; width:140px;"
             hidden>
          Grabando: 0 pasos…
        </div>

        <!-- centro -->
        <button class="petal center" data-status="3" aria-label="Detener"></button>

        <!-- pétalos (arriba/der/izq) -->
        <button class="petal p-top"      data-status="1" aria-label="Adelante"></button>
        <button class="petal p-top-right" data-status="8" aria-label="Giro 90 derecha"></button>
        <button class="petal p-right"     data-status="4" aria-label="Vuelta adelante derecha"></button>
        <button class="petal p-bottom-right" data-status="6" aria-label="Vuelta atrás derecha"></button>

        <button class="petal p-bottom" data-status="2" aria-label="Atrás"></button>
        <button class="petal p-bottom-left" data-status="7" aria-label="Vuelta atrás izquierda"></button>
        <button class="petal p-left"   data-status="5" aria-label="Vuelta adelante izquierda"></button>
        <button class="petal p-top-left" data-status="9" aria-label="Giro 90 izquierda"></button>

        <!-- hojas 360° -->
        <button class="leaf leaf-left"  data-status="11" aria-label="Giro 360 izquierda"></button>
        <button class="leaf leaf-right" data-status="10" aria-label="Giro 360 derecha"></button>
      </div>
    </section>
  </main>

  <!-- Modal: Cargar secuencias -->
  <div class="modal fade" id="modalCargar" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content modal-soft">
        <div class="modal-header">
          <h5 class="modal-title">Seleccione</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Salir"></button>
        </div>
        <div class="modal-body">
          <div class="list-group" id="listaSecuencias"></div>
        </div>
        <div class="modal-footer">
          <button id="btnReproducir" class="btn btn-primary" disabled>Reproducir</button>
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Salir</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Reproducción con animación -->
  <div class="modal fade" id="modalPlayer" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content modal-soft">
        <div class="modal-body">
          <div class="player-box">
            <div class="car-anim" id="carAnim"></div>
          </div>
          <div class="d-flex gap-3 justify-content-center mt-3">
            <button id="btnSimObst" class="btn btn-outline-primary">Obstáculo</button>
            <!-- Botón 'Detener' ELIMINADO a petición -->
            <button id="btnExitRun" class="btn btn-outline-secondary" data-bs-dismiss="modal">Salir</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Confirmación reanudar (queda, pero ya no se usa al quitar "Detener") -->
  <div class="modal fade" id="modalConfirm" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
      <div class="modal-content modal-soft">
        <div class="modal-body text-center">
          <p class="mb-3">Se detuvo la secuencia, ¿desea continuar?</p>
          <div class="d-flex gap-2 justify-content-center">
            <button id="btnConfirmSi" class="btn btn-primary">Sí</button>
            <button id="btnConfirmNo" class="btn btn-outline-secondary" data-bs-dismiss="modal">No</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // La API queda igual; el WS nativo ya no se usa.
    // SIO apunta al mismo host:puerto de Flask (5500) y al namespace /ws del back.
    window.CONFIG = {
      API: "http://127.0.0.1:5500/api",
      SIO: "http://127.0.0.1:5500",   // base del servidor Flask+Socket.IO
      SIO_NAMESPACE: "/ws",            // namespace del back
      SIO_EVENT: "broadcast"           // evento que emite el back
    };
  </script>

  <!-- CDN Socket.IO v4 -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/main.js"></script>

</body>
</html>
